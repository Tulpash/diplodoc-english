# Объекты в PostgreSQL
Здесь описаны основные объекты PostgreSQL.
[Официальная документация](https://www.postgresql.org/docs/17/index.html)

## 1. База данных (Database)
**Описание:** Логический контейнер для хранения всех объектов базы. Каждая юаза изолированна и "из коробки" операции между базаит недоступны.
**Назначение:** Организация данных в пределдах одного кластера.
**Версия:** Базы существуют с первой версии (1986), поддержка нескольких БД в кластере появилась в версии 7.0 (2000).
**Пример:**
```sql
CREATE DATABASE myapp;
```

## 2. Схема (Schema)
**Описание:** Пространство имен для группировки объектов.
**Назначение:** Логическая организация данных, разделение ответственности по ролям.
**Версия:** Появилась в версии 7.3 (2002).
**Пример:**
```sql
CREATE SCHEMA myschema;
```

## 3. Таблица (Table)
**Описание:** Основной объект для хранения данных в ивиде строк и столбцов.
**Назначение:** Хранение структурированных данных.
**Версия:** Существуют с первой версии, в 8.0 (2004) было добавлено наследование таблиц, в 9.1 (2011) появились внешние ключи.
**Пример:**
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 4. Представление (View)
**Описание:** Виртуальная таблица предоставляющая результат SQL-запрроса, данные не хранятся физически а вычисляются каждый раз.
**Назначение:** Упрощение сложных запросов, предоставление среза данных.
**Версия:** Существуют с первой версии.
**Пример:**
```sql
CREATE VIEW active_users AS
SELECT id, email FROM users WHERE active = true;
```

## 5. Материализованное представление (Materialized View)
**Описание:** Физическая копия данных сделанная на основе SQL-запроса, в отличие от обычного представления данные хранятся на диске.
**Назначение:** Кеширование результата сложных запросов, оптимизация.
**Версия:** Введены в версии 9.3 (2013), в 9.4 (2014) введена команада `REFRESH MATERIALIZED VIEW CONCURRENTLY` для обновления данных без блокировки чтения.
**Пример:**
```sql
CREATE MATERIALIZED VIEW user_stats AS
SELECT department, COUNT(*) as user_count
FROM users
GROUP BY department;
REFRESH MATERIALIZED VIEW user_stats;
```

## 6. Индекс (Index)
**Описание:** Структура данных ускоряющая доступ к данным в таблице.
**Назначение:** Ускорение чтения данных, фильтрации, сортировки.
**Версия:** Существуют с первой версии, некоторые типы были введены позже:
- GiST 7.2 (2002)
- GIN 8.4 (2009)
- BRIN 9.5 (2016)
- Hash 10 (2017)
**Пример:**
```sql
CREATE INDEX idx_users_email ON users (email);
```

## 7. Функция (Function)
**Описание:** Логика написанная на SQL, PL/pgSQL или других языках с возвращаемыми данными.
**Назначение:** Реализации логики на стороне БД.
**Версия:** Существуют с первой версии, поддержка PL/pgSQL появилась в 6.4 (1998), `RETURNS TABLE` добавлены в 9.0 (2010).
**Пример:**
```sql
CREATE FUNCTION count_active_users() RETURNS INTEGER AS $$
BEGIN
    RETURN (SELECT COUNT(*) FROM users WHERE active = true);
END;
$$ LANGUAGE plpgsql;
```

## 8. Процедура (Procedure)
**Описание:** Аналог функции но без возврата данных.
**Назначение:** Управление транзакциями, выполнение сложных операций.
**Версия:** Добавлены в 11 (2018).
**Пример:**
```sql
CREATE PROCEDURE deactivate_user(user_id INT) AS $$
BEGIN
    UPDATE users SET active = false WHERE id = user_id;
    COMMIT;
END;
$$ LANGUAGE plpgsql;
```

## 9. Триггер (Trigger)
**Описание:** Логика автоматически вызываемая при определенных действиях.
**Назначение:** Автоматизация логики.
**Версия:** Существуют с первой версии, в 9.0 (2010) добавлены триггеры на уровне строк для представлений `INSTEAD OF`.
**Пример:**
```sql
CREATE FUNCTION log_user_changes() RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO user_log (user_id, action, timestamp)
    VALUES (NEW.id, TG_OP, NOW());
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER user_change_trigger
AFTER INSERT OR UPDATE ON user_log
FOR EACH ROW EXECUTE FUNCTION log_user_changes();
```

## 10. Последовательность (Sequence)
**Описание:** Объекты для генерации уникальных числовых идентификаторов.
**Назначение:** Автоматическая генерация идентификаторов.
**Версия:** Существуют с первой версии, в 8.2 (2006) улучшена производительность.
**Пример:**
```sql
CREATE SEQUENCE my_seq START 1 INCREMENT 1;
SELECT nextval('my_seq');
```

## 11. Тип данных (Type)
**Описание:** Пользовательский тип данных.
**Назначение:** Создание пользовательских данных для упрощения логики.
**Версия:** Композитные типы данных 8.0 (2004), перечисления с 8.3 (2008).
**Пример:**
```sql
CREATE TYPE user_role AS ENUM ('admin', 'user', 'guest');
ALTER TABLE users ADD COLUMN role user_role;
```

## 12. Домены (Domain)
**Описание:** Пользовательский тип данных с логикой ограничения.
**Назначение:** Создание пользовательских данных для упрощения логики.
**Версия:** Появились в 7.3 (2002).
**Пример:**
```sql
CREATE DOMAIN positive_int AS INTEGER CHECK (VALUE > 0);
CREATE TABLE items (id SERIAL, quantity positive_int);
```

## 13. Роли (Role)
**Описание:** Объект для управления правами пользователей.
**Назначение:** Управление аутентификацией и авторизацией.
**Версия:** Существуют с первых версий, в 8.1 (2005) роли заменили пользователей и группы, как единый механизм.
**Пример:**
```sql
CREATE ROLE app_user WITH LOGIN PASSWORD 'secure';
GRANT SELECT, INSERT ON users TO app_user;
```

## 14. Таблицы FDW (Foreing Data Wrapper)
**Описание:** Таблицы предоставляющие доступ к данным из внешних источников.
**Назначение:** Интеграция с внешними системамий.
**Версия:** Добавлены в 9.1 (2011).
**Пример:**
```sql
CREATE EXTENSION postgres_fdw;
CREATE FOREIGN TABLE remote_users (
    id INT,
    name TEXT
) SERVER remote_server OPTIONS (schema_name 'public', table_name 'users');
```

## 15. Расширения (Extension)
**Описание:** Модули добавляющие функциональность.
**Назначение:** Расширение возможностей без изменения исходного кода.
**Версия:** Добавлены в 9.1 (2011).
**Пример:**
```sql
CREATE EXTENSION pgcrypto;
```

## 16. Ограничения (Constraint)
**Описание:** Правила применяемые к данным в таблицах.
**Назначение:** Сохранения целостности данных.
**Версия:** Существуют с первой версии, в 9.1 (2011) появились FK.
**Пример:**
```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id),
    amount DECIMAL CHECK (amount > 0)
);
```

## 17. Таблицы наследования (Inherited Tables)
**Описание:** Таблицы наследующие структуру от других.
**Назначение:** Реализация объектно ориентирвоанного подхода.
**Версия:** Существуют с 8.0 (2004).
**Пример:**
```sql
CREATE TABLE vehicles (id SERIAL, type TEXT);
CREATE TABLE cars (model TEXT) INHERITS (vehicles);
```

## 18. Пространство таблиц (Tablespace)
**Описание:** Физическая область хранения таблиц.
**Назначение:** Управление хранением данных для оптимизации производительности или разделения данных.
**Версия:** Добавлены в 8.0 (2004).
**Пример:**
```sql
CREATE TABLESPACE fast_storage LOCATION '/mnt/fast';
CREATE TABLE users (id SERIAL) TABLESPACE fast_storage;
```

## 19. Статистика (Statistics)
**Описание:** Метаданные собираемые PostgeSQL для оптимизации запросов.
**Назначение:** Помощь в оптимизации запросов.
**Версия:** Существует с первых версий.
**Пример:**
```sql
ANALYZE users;
```

## 20. Событийный тригер (Event Trigger)
**Описание:** Триггер срабатывающий на определенные события БД.
**Назначение:** Мониторинг и аудит изменений в структуре БД.
**Версия:** Введены в 9.3 (2013).
**Пример:**
```sql
CREATE EVENT TRIGGER log_ddl ON ddl_command_start
EXECUTE FUNCTION log_ddl_changes();
```

## 21. Агрегатная функция (Agregate Function)
**Описание:** Пользовательские функции для выполнения агрегации, по аналогии с `SUM`, `COUNT`.
**Назначение:** Обобщение и упрощение логики.
**Версия:** Введены в 8.0 (2004).
**Пример:**
```sql
CREATE AGGREGATE my_avg (INTEGER) (
    SFUNC = int4_sum,
    STYPE = BIGINT,
    FINALFUNC = int4_avg
);
```