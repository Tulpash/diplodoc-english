# План запроса
План запроса в PostgreSQL — это дерево выполнения (query execution plan), состоящее из узлов (nodes), каждый из которых представляет определённую операцию. Узлы организованы иерархически: корневой узел возвращает итоговый результат, а дочерние узлы выполняют промежуточные шаги.

## Основные компоненты плана запроса
- **Узлы (Nodes):** Каждый узел представляет операцию, такую как сканирование таблицы, объединение (join), сортировка или агрегация.
- **Оценочная стоимость (Cost):** Для каждого узла указывается предполагаемая стоимость выполнения (в условных единицах, учитывающих CPU, I/O и т.д.).
- **Ожидаемое количество строк (Rows):** Оценка числа строк, которые узел вернёт.
- **Размер данных (Width):** Оценка среднего размера строки в байтах.
- **Условия и фильтры:** Указание, какие условия (WHERE, JOIN ON) применяются в узле.
- **Индексы:** Информация об использовании индексов, если они задействованы.

## Основные типы узлов
- **Scan:** 
    - **Seq Scan:** Полное последовательное сканирование таблицы.
    - **Index Scan:** Сканирование с использованием индекса.
    - **Index Only Scan:** Сканирование только индекса, если все данные доступны в нём.
    - **Bitmap Index Scan:** Использование битовой карты для выборки строк.
- **Join:**
    - **Nested Loop:** Пошаговое сравнение строк двух таблиц.
    - **Hash Join:** Создание хеш-таблицы для одной таблицы и её объединение с другой.
    - **Merge Join:** Объединение отсортированных наборов данных.
- **Аггрегация и сортировка:**
    - **Aggregate:** Выполнение функций агрегации (SUM, COUNT, и т.д.).
    - **Sort:** Сортировка данных (ORDER BY).
    - **Group:** Группировка данных (GROUP BY).
- **Модификация данных:**
    - `INSERT`
    - `UPDATE`
    - `DELETE`
- **Другое:**
    - Limit
    - Offset
    - `UNION`

## Пример плана запроса
```sql
EXPLAIN SELECT name, age FROM users WHERE age > 30 ORDER BY name;
```

```txt
Sort  (cost=22.50..23.00 rows=200 width=32)
  Sort Key: name
  -> Seq Scan on users  (cost=0.00..20.00 rows=200 width=32)
       Filter: (age > 30)
```

**Sort:** Корневой узел, выполняет сортировку по столбцу name.
**Cost:** `cost=22.50..23.00`, (22.50) — стоимость до начала вывода строк (startup cost), (23.00) — полная стоимость (total cost). 
**Seq Scan:** Дочерний узел, сканирует таблицу users последовательно.
**Rows:** Оценка количества строк (200).
**Width:** Средний размер строки в байтах (32).
**Filter:** Условие age > 30 применяется к строкам.