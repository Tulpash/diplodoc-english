# Locks
PostgreSQL использует MVCC (Multi Version Concurrency Control), что позволяет транзакциям работать с "снимками" данных, избегая блокировок для чтения в большинстве случаев. Однако блокировки всё равно необходимы для операций, изменяющих данные, или для предотвращения конфликтов в специфических сценариях.

## Table  Locks
PostgreSQL поддерживает несколько режимов блокировок таблиц, которые определяют, какие операции могут выполняться параллельно. Основные режимы (в порядке увеличения строгости):
**ACCESS SHARE** - Разрешает все, пока не изменяется структура таблицы.Устанавливается по умолчанию при `SELECT`
**ROW SHARE** - Позволяет читать но запрезает изменять данные. Устанавливается по умолчания при `SELECT ... FOT UPDATE` и `SELECT ... FOR SHARE`
**ROW EXCLUSIVE** - Запрещает олновременное изменение строк разными трагзакциями. Устанавливается по умолчанию при `INSERT`, `UPDATE`, `DELETE`
**SHARE** - Используется для операций которые требуют согласованности данных
**SHARE ROW EXCLUSIVE** - исползуется дял операций которые требуют эксклюзивного доступа к строкам н оне к структуре таблицы
**EXCLUSIVE** - блокирует все опреации кроме чтения
**ACCESS EXCLUSIVE** - Запрещает любой доступ к таблице

## Row Locks
`SELECT ... FOR UPDATE` - 
`SELECT ... FOR SHARE` -

## Advisory Locks
PostgreSQL поддерживает консультативные блокировки, которые не связаны с данными напрямую, а используются для координации на уровне приложения. Это полезно, когда вы хотите управлять доступом к ресурсам, не связанным с таблицами. Эти блокировки не зависят от транзакций и могут быть полезны в приложениях на C# или Go для синхронизации сложных операций.

## Механизм работы блокировок
- **Очередь блокировок:** Если транзакция не может получить блокировку (например, другая транзакция уже удерживает конфликтующую блокировку), она помещается в очередь ожидания. PostgreSQL отслеживает эти очереди и может обнаруживать deadlocks (взаимоблокировки).
- **Обнаружение дедлоков:** PostgreSQL периодически проверяет граф зависимостей между транзакциями. Если обнаруживается цикл (deadlock), одна из транзакций прерывается с ошибкой deadlock detected.
- **Таймауты:** Параметр lock_timeout позволяет задать максимальное время ожидания блокировки. Если время превышено, транзакция завершится с ошибкой.