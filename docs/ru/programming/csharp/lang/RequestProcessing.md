# Как обрабатывается HTTP запрос

## 1. Получение запроса (Kestrel)
HTTP запрос поступает на вебсервер, по умолчанию используется Kestrel. Веб сервер принимает входящие TCP соединения, парсит запрос и передает его в конфейер Middleware.

**Детали:**
- Kestrel работает на оснвое библиотеки `System.Net.Sockets`
- Если приложение размещено за проски, то прокси перенаправляе тзапросы в Kestrel

## 2. Создание контекста запроса
Веб сервер создает объект `HttpContext`, который инкапсулирует всю информацию о запросе и ответе.

## 3. Конвейер Middleware
Объект `HttpContext` передается в конвейер middleware 

## 4. Маршрутизация
Middleware `UseRouting` сопоставляет URL запроса с конечной точкой на основе маршрутов определенных в приложении.

**Детали:**
- Маршруты сопоставляются на основе шаблонов
- Middleware `UseEndpoints` выполняет выбранную конечную точку после маршрутизации

## 5. Привязка модели
`ModelBinder` и `IValueProvider` при помощи рефлексии создают и заполняет данными нужные объекты

## 6. Обработка запроса в конечной точке
После маршрутизации запрос передается в конечную точку, которая формирует ответ.

## 7. Формирование ответа
В свойство Response, объекта `HttpContext`, записывается статус код, тело ответа, заголовки и прочая информация. Затем обхект `HttpContext` проходит конвейер Middleware в обратном порядке.

## 8. Завершение запроса
Веб сервер отправялет ответ по TCP соединению к клиенту.