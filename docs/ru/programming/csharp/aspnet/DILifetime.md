# DI Lifetime

## Transient
Новый экземпляр создается каждый раз когда он запрашивается через DI контейнер.

**Когда использовать:**
- Сервис лёгкий (создание экземпляра не требует значительных ресурсов).
- Сервис не хранит состояние (stateless) или состояние должно быть уникальным для каждого вызова.
- Требуется полная изоляция между вызовами, чтобы избежать побочных эффектов.
- Подходит для операций, где каждый вызов должен быть независимым.

**Примеры сценариев:**
- Генерация уникального идентификатора (например, GUID) для каждого вызова.
- Обработка одноразовых вычислений, например, форматирование данных для конкретного запроса.
- Временные сервисы, такие как парсеры или валидаторы, которые не зависят от контекста запроса.

## Scoped
Один экземпляр сервиса создаётся на один scope. В ASP.NET Core scope обычно соответствует одному HTTP-запросу. Все зависимости в рамках этого scope используют один и тот же экземпляр.

**Когда использовать:**
- Сервис должен сохранять состояние в рамках одного запроса, но не между запросами.
- Работа с контекстом, специфичным для запроса, например, с базой данных через Entity Framework Core.
- Подходит для большинства веб-приложений, где данные или ресурсы должны быть согласованными в рамках одного запроса.

**Примеры сценариев:**
- Контекст базы данных (DbContext в EF Core), который должен быть уникальным для каждого запроса, чтобы корректно управлять транзакциями.
- Сервисы, которые кэшируют данные или состояние в рамках одного запроса (например, пользовательская сессия).
- Обработка запросов, где требуется согласованность данных, например, валидация формы или обработка корзины покупок.

## Singleton
Один экземпляр сервиса создаётся на всё время жизни приложения. Все запросы и scope используют один и тот же объект.

**Когда использовать:**
- Сервис должен хранить глобальное состояние, общее для всех запросов и пользователей.
- Создание экземпляра дорогое (например, подключение к внешнему ресурсу или загрузка конфигурации).
- Сервис является потокобезопасным или не изменяет состояние

**Примеры сценариев:**
- Глобальный кэш (например, IMemoryCache для хранения данных, общих для всех пользователей).
- Сервис конфигурации, который загружает настройки один раз при старте приложения.
- Логгер, который пишет в общий файл или внешний сервис.
- Пул соединений (например, для Redis, gRPC или других внешних сервисов).